import random


def get_valid_directions(x, y, width, height):
    directions = []

    if y < height:
        directions.append('n')
    if y > 1:
        directions.append('s')
    if x < width:
        directions.append('e')
    if x > 1:
        directions.append('w')

    return directions


def direction_string(directions):
    dir_map = {
        'n': '(N)orth',
        'e': '(E)ast',
        's': '(S)outh',
        'w': '(W)est'
    }
    return f"You can travel: {' or '.join(dir_map[d] for d in directions)}."


def move(x, y, direction):
    if direction == 'n':
        return x, y + 1
    if direction == 's':
        return x, y - 1
    if direction == 'e':
        return x + 1, y
    if direction == 'w':
        return x - 1, y
    return x, y


def init_levers(width, height, count=4, forbidden=None):
    if forbidden is None:
        forbidden = []

    levers = {}
    while len(levers) < count:
        x = random.randint(1, width)
        y = random.randint(1, height)
        if (x, y) not in forbidden:
            levers[(x, y)] = random.randint(1, 3)
    return levers


def handle_lever(x, y, levers, gold):
    if (x, y) in levers:
        if levers[(x, y)] > 0:
            choice = input("You see a lever. Pull it? (y/n): ").lower()
            if choice == 'y':
                levers[(x, y)] -= 1
                gold += 1
                print("You receive a gold coin.")
        else:
            print("The lever here is depleted.")
    return gold


def main():
    width = random.randint(3, 9)
    height = random.randint(3, 9)

    x, y = 1, 1
    gold = 0

    victory_tile = (random.randint(1, width), random.randint(1, height))
    while victory_tile == (1, 1):
        victory_tile = (random.randint(1, width), random.randint(1, height))

    levers = init_levers(
        width,
        height,
        count=4,
        forbidden=[(1, 1), victory_tile]
    )

    print(f"Map size: {width} x {height}")
    print("Find the victory tile!\n")

    while True:
        print(f"Gold: {gold}")
        print(f"You are on tile ({x}, {y}).")

        if (x, y) == victory_tile:
            print("Victory! You found the goal!")
            break

        gold = handle_lever(x, y, levers, gold)

        valid_directions = get_valid_directions(x, y, width, height)
        print(direction_string(valid_directions))

        direction = input("Direction: ").lower()
        if direction in valid_directions:
            x, y = move(x, y, direction)
        else:
            print("Not a valid direction!")


main()
